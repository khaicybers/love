<!-- 
<!DOCTYPE html>
<html lang="en" class="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dkhainee</title>
    <link href="https://fonts.bunny.net/css?family=instrument-sans:400,500,600" rel="stylesheet"/>
    <link rel="stylesheet" href="/static/css/app.css" />
  </head>
  <body class="font-sans antialiased">
    <div
      id="app"
      data-page='{
        "component": "views/home",
        "props": {
          "errors": {},
          "name": "duykhainee",
          "quote": {
            "message": "",
            "author": ""
          },
          "auth": {
            "user": null
          },
          "ziggy": {
            "port": null,
            "defaults": [],
            "routes": {
              "home": {
                "uri": "/",
                "methods": ["GET", "HEAD"]
              },
              "show-create-form": {
                "uri": "create-message/{id?}",
                "methods": ["GET", "HEAD"],
                "parameters": ["id"]
              },
              "create-form": {
                "uri": "create-message",
                "methods": ["POST"]
              },
              "login": {
                "uri": "login",
                "methods": ["GET", "HEAD"]
              },
              "logout": {
                "uri": "logout",
                "methods": ["POST"]
              },
              "storage.local": {
                "uri": "storage/{path}",
                "methods": ["GET", "HEAD"],
                "wheres": {
                  "path": ".*"
                },
                "parameters": ["path"]
              }
            },
            "location": ""
          },
          "message": "",
          "client": {
            "fontName": "Mali",
            "color": "#ff0019",
            "messages": [
              "duykhainee",
              "Test 1",
              "Test 2"
            ],
            "music": "//thanhdieu.com/music.mp3"
          },
          "clientId": "/"
        },
        "url": "/",
        "version": "",
        "clearHistory": false,
        "encryptHistory": false
      }
      '
    >
  </div>
  <script type="module" src="/static/js/app.js"></script>
  <script type="module" src="/static/js/home.js"></script>
  </body>
</html> -->
<!DOCTYPE html>
<html lang="en" class="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dkhainee</title>
    <link href="https://fonts.bunny.net/css?family=instrument-sans:400,500,600" rel="stylesheet"/>
    <link rel="stylesheet" href="/static/css/app.css" />
  </head>
  <body class="font-sans antialiased">
    <div
      id="app"
      data-page='{
        "component": "views/home",
        "props": {
          "errors": {},
          "name": "duykhainee",
          "quote": {
            "message": "",
            "author": ""
          },
          "auth": {
            "user": null
          },
          "ziggy": {
            "port": null,
            "defaults": [],
            "routes": {
              "home": {
                "uri": "/",
                "methods": ["GET", "HEAD"]
              },
              "show-create-form": {
                "uri": "create-message/{id?}",
                "methods": ["GET", "HEAD"],
                "parameters": ["id"]
              },
              "create-form": {
                "uri": "create-message",
                "methods": ["POST"]
              },
              "login": {
                "uri": "login",
                "methods": ["GET", "HEAD"]
              },
              "logout": {
                "uri": "logout",
                "methods": ["POST"]
              },
              "storage.local": {
                "uri": "storage/{path}",
                "methods": ["GET", "HEAD"],
                "wheres": {
                  "path": ".*"
                },
                "parameters": ["path"]
              }
            },
            "location": ""
          },
          "message": "",
          "client": {
            "fontName": "Mali",
            "color": "#ff0019",
            "messages": [
              "duykhainee",
              "Test 1",
              "Test 2"
            ],
            "music": "//thanhdieu.com/music.mp3"
          },
          "clientId": "/"
        },
        "url": "/",
        "version": "",
        "clearHistory": false,
        "encryptHistory": false
      }
      '
    >
  </div>
  <script>
    // Lưu URL gốc với parameters
    const originalUrl = window.location.href;
    const originalSearch = window.location.search;

    // Lấy parameters từ URL
    function getUrlParams() {
      const params = new URLSearchParams(window.location.search);
      return {
        name: params.get('name'),
        messages: params.get('messages')
      };
    }

    // Cập nhật dữ liệu trong data-page
    function updateDataPage() {
      const urlParams = getUrlParams();
      const appDiv = document.getElementById('app');
      const dataPage = JSON.parse(appDiv.getAttribute('data-page'));
      
      // Thay đổi tên nếu có
      if (urlParams.name) {
        dataPage.props.name = urlParams.name;
      }
      
      // Thay đổi messages nếu có (phân tách bằng dấu |)
      if (urlParams.messages) {
        const messagesArray = urlParams.messages.split('|').map(msg => msg.trim());
        dataPage.props.client.messages = messagesArray;
      }
      
      // Cập nhật URL trong ziggy để giữ nguyên parameters
      if (originalSearch) {
        dataPage.props.ziggy.location = originalUrl;
        dataPage.url = originalUrl;
      }
      
      // Cập nhật lại data-page
      appDiv.setAttribute('data-page', JSON.stringify(dataPage));
    }

    // Chạy khi trang load
    updateDataPage();

    // Ngăn chặn việc thay đổi URL bởi history API
    const originalPushState = history.pushState;
    const originalReplaceState = history.replaceState;

    history.pushState = function(state, title, url) {
      // Nếu URL mới không có parameters và URL gốc có, thì giữ lại parameters
      if (originalSearch && url && !url.includes('?')) {
        url = url + originalSearch;
      }
      return originalPushState.apply(history, [state, title, url]);
    };

    history.replaceState = function(state, title, url) {
      // Nếu URL mới không có parameters và URL gốc có, thì giữ lại parameters
      if (originalSearch && url && !url.includes('?')) {
        url = url + originalSearch;
      }
      return originalReplaceState.apply(history, [state, title, url]);
    };
  </script>
  <script type="module" src="/static/js/app.js"></script>
  <script type="module" src="/static/js/home.js"></script>
  </body>
</html>
